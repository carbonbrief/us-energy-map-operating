var map = L.map('mapid', {zoomControl: false}).setView([28, -100], 4)

var Esri_WorldGrayCanvas = L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}', {
	attribution: 'Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ',
	maxZoom: 16
}).addTo(map);

var Esri_WorldImagery = L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
	attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
});

// L.tileLayer('https://api.mapbox.com/styles/v1/rospearce/ciwgju4yv00cy2pmqeggx1mx8/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1Ijoicm9zcGVhcmNlIiwiYSI6ImNpdm1sczJsZjAwOGMyeW1xNHc4ejJ0N28ifQ.4B24e0_HgfJj4sgqimETqA', {
//     attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
//     maxZoom: 5,
// 	minZoom: 1,
//     id: 'mapbox://styles/rospearce/ciwgju4yv00cy2pmqeggx1mx8',
//     accessToken: 'pk.eyJ1Ijoicm9zcGVhcmNlIiwiYSI6ImNpdm1sczJsZjAwOGMyeW1xNHc4ejJ0N28ifQ.4B24e0_HgfJj4sgqimETqA'
// }).addTo(map);

//disable scroll wheel zoom

map.scrollWheelZoom.disable();

var states = [
    { "type": "Feature", "id": 49, "properties": { "scalerank": 2, "featurecla": "Admin-1 scale rank", "adm1_code": "USA-3562" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ -90.395278, 46.611677 ], [ -90.355590, 46.673069 ], [ -90.298979, 46.760919 ], [ -90.241825, 46.848226 ], [ -90.185213, 46.936076 ], [ -90.128059, 47.023900 ], [ -90.071448, 47.111750 ], [ -90.014810, 47.199600 ], [ -89.957656, 47.286907 ], [ -89.842831, 47.464726 ], [ -89.728006, 47.641976 ], [ -89.613698, 47.819252 ], [ -89.522695, 47.960535 ], [ -89.488885, 48.015263 ], [ -89.272917, 48.019808 ], [ -89.185610, 48.047326 ], [ -88.378114, 48.302918 ], [ -87.494396, 47.961595 ], [ -87.208108, 47.848372 ], [ -86.921846, 47.735123 ], [ -86.672068, 47.636162 ], [ -86.495335, 47.566838 ], [ -86.428647, 47.539838 ], [ -86.234447, 47.459946 ], [ -86.040247, 47.380054 ], [ -85.846563, 47.300136 ], [ -85.652363, 47.220219 ], [ -85.458163, 47.139810 ], [ -85.263963, 47.059893 ], [ -85.070280, 46.980001 ], [ -84.876080, 46.900083 ], [ -84.826858, 46.766732 ], [ -84.779238, 46.637102 ], [ -84.543749, 46.538684 ], [ -84.543232, 46.538684 ], [ -84.604900, 46.439600 ], [ -84.336700, 46.408770 ], [ -84.142120, 46.512226 ], [ -84.128374, 46.483649 ], [ -84.115144, 46.370917 ], [ -84.091851, 46.275419 ], [ -83.890765, 46.116927 ], [ -83.763228, 46.108969 ], [ -83.669048, 46.122741 ], [ -83.616131, 46.116927 ], [ -83.469551, 45.994686 ], [ -83.592851, 45.816894 ], [ -83.397049, 45.729044 ], [ -83.179052, 45.632719 ], [ -82.919223, 45.517920 ], [ -82.760473, 45.447510 ], [ -82.550925, 45.347517 ], [ -82.515475, 45.204114 ], [ -82.485296, 45.083993 ], [ -82.446667, 44.915708 ], [ -82.407523, 44.743729 ], [ -82.368352, 44.572809 ], [ -82.326546, 44.391296 ], [ -82.281044, 44.192342 ], [ -82.240840, 44.015608 ], [ -82.196373, 43.822442 ], [ -82.137642, 43.571088 ], [ -82.190559, 43.474272 ], [ -82.417031, 43.017607 ], [ -82.429743, 42.980038 ], [ -82.900180, 42.430227 ], [ -83.119779, 42.079912 ], [ -83.128771, 42.068802 ], [ -83.142000, 41.975681 ], [ -83.462678, 41.694148 ], [ -83.839967, 41.685156 ], [ -84.295056, 41.685156 ], [ -84.806756, 41.677741 ], [ -84.807299, 41.756056 ], [ -85.748146, 41.751302 ], [ -86.824462, 41.756056 ], [ -86.824462, 41.760836 ], [ -86.918126, 41.760836 ], [ -87.221337, 41.760836 ], [ -87.175836, 41.943900 ], [ -87.130335, 42.127015 ], [ -87.084808, 42.309562 ], [ -87.039307, 42.492652 ], [ -87.079537, 42.782118 ], [ -87.113928, 43.030294 ], [ -87.155191, 43.326632 ], [ -87.145140, 43.571088 ], [ -87.141962, 43.657878 ], [ -87.083232, 43.890190 ], [ -87.032434, 44.091288 ], [ -86.918668, 44.361685 ], [ -86.822344, 44.591335 ], [ -86.714934, 44.846410 ], [ -86.536082, 45.041670 ], [ -86.401672, 45.133214 ], [ -86.264600, 45.226878 ], [ -86.481563, 45.323177 ], [ -86.774207, 45.452291 ], [ -86.942465, 45.452291 ], [ -87.115504, 45.452291 ], [ -87.244617, 45.289846 ], [ -87.419775, 45.184012 ], [ -87.459462, 45.068128 ], [ -87.612915, 45.110451 ], [ -87.613975, 45.108875 ], [ -87.747326, 45.226878 ], [ -87.673248, 45.387747 ], [ -87.893389, 45.396713 ], [ -87.847888, 45.559183 ], [ -87.787013, 45.639618 ], [ -87.875406, 45.779842 ], [ -88.111929, 45.843352 ], [ -88.166964, 46.007916 ], [ -88.361707, 46.020628 ], [ -88.644274, 46.022204 ], [ -89.221060, 46.202116 ], [ -90.096304, 46.380994 ], [ -90.176738, 46.560879 ], [ -90.333912, 46.593694 ], [ -90.334971, 46.596872 ], [ -90.396880, 46.576253 ], [ -90.410626, 46.584185 ], [ -90.395278, 46.611677 ] ] ] } },
    { "type": "Feature", "id": 50, "properties": { "scalerank": 2, "featurecla": "Admin-1 scale rank", "adm1_code": "USA-3563" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ -153.228729, 57.968968 ], [ -152.564791, 57.901427 ], [ -152.141147, 57.591059 ], [ -153.006314, 57.115842 ], [ -154.005090, 56.734677 ], [ -154.516403, 56.992749 ], [ -154.670993, 57.461196 ], [ -153.762780, 57.816575 ], [ -153.228729, 57.968968 ] ] ], [ [ [ -166.467792, 60.384170 ], [ -165.674430, 60.293607 ], [ -165.579164, 59.909987 ], [ -166.192770, 59.754441 ], [ -166.848337, 59.941406 ], [ -167.455277, 60.213069 ], [ -166.467792, 60.384170 ] ] ], [ [ [ -171.731657, 63.782515 ], [ -171.114434, 63.592191 ], [ -170.491112, 63.694975 ], [ -169.682505, 63.431116 ], [ -168.689439, 63.297506 ], [ -168.771941, 63.188598 ], [ -169.529440, 62.976931 ], [ -170.290556, 63.194438 ], [ -170.671386, 63.375822 ], [ -171.553063, 63.317789 ], [ -171.791111, 63.405846 ], [ -171.731657, 63.782515 ] ] ], [ [ [ -140.985988, 69.711998 ], [ -140.985988, 69.711998 ], [ -140.992499, 66.000029 ], [ -140.997770, 60.306397 ], [ -140.012998, 60.276838 ], [ -139.039000, 60.000007 ], [ -138.340878, 59.562101 ], [ -137.452508, 58.904984 ], [ -136.479725, 59.463864 ], [ -135.475833, 59.787772 ], [ -134.944987, 59.270543 ], [ -134.271100, 58.861110 ], [ -133.355549, 58.410285 ], [ -132.730421, 57.692887 ], [ -131.707822, 56.552104 ], [ -130.007770, 55.915812 ], [ -129.979994, 55.284998 ], [ -130.536110, 54.802753 ], [ -131.085818, 55.178906 ], [ -131.967211, 55.497776 ], [ -132.250011, 56.369996 ], [ -133.539181, 57.178887 ], [ -134.078063, 58.123068 ], [ -135.038211, 58.187715 ], [ -136.628062, 58.212209 ], [ -137.800006, 58.499995 ], [ -139.867787, 59.537762 ], [ -140.825274, 59.727517 ], [ -142.574444, 60.084447 ], [ -143.958881, 59.999180 ], [ -145.925557, 60.458610 ], [ -147.114374, 60.884656 ], [ -148.224306, 60.672989 ], [ -148.018066, 59.978329 ], [ -148.570823, 59.914173 ], [ -149.727858, 59.705658 ], [ -150.608243, 59.368211 ], [ -151.716393, 59.155821 ], [ -151.859433, 59.744984 ], [ -151.409719, 60.725803 ], [ -150.346941, 61.033588 ], [ -150.621111, 61.284425 ], [ -151.895839, 60.727198 ], [ -152.578330, 60.061657 ], [ -154.019172, 59.350279 ], [ -153.287511, 58.864728 ], [ -154.232492, 58.146374 ], [ -155.307491, 57.727795 ], [ -156.308335, 57.422774 ], [ -156.556097, 56.979985 ], [ -158.117217, 56.463608 ], [ -158.433321, 55.994154 ], [ -159.603327, 55.566686 ], [ -160.289720, 55.643581 ], [ -161.223048, 55.364735 ], [ -162.237766, 55.024187 ], [ -163.069447, 54.689737 ], [ -164.785569, 54.404173 ], [ -164.942226, 54.572225 ], [ -163.848340, 55.039431 ], [ -162.870001, 55.348043 ], [ -161.804175, 55.894986 ], [ -160.563605, 56.008055 ], [ -160.070560, 56.418055 ], [ -158.684443, 57.016675 ], [ -158.461097, 57.216921 ], [ -157.722770, 57.570001 ], [ -157.550274, 58.328326 ], [ -157.041675, 58.918885 ], [ -158.194731, 58.615802 ], [ -158.517218, 58.787781 ], [ -159.058606, 58.424186 ], [ -159.711667, 58.931390 ], [ -159.981289, 58.572549 ], [ -160.355271, 59.071123 ], [ -161.355003, 58.670838 ], [ -161.968894, 58.671665 ], [ -162.054987, 59.266925 ], [ -161.874171, 59.633621 ], [ -162.518059, 59.989724 ], [ -163.818341, 59.798056 ], [ -164.662218, 60.267484 ], [ -165.346388, 60.507496 ], [ -165.350832, 61.073895 ], [ -166.121379, 61.500019 ], [ -165.734452, 62.074997 ], [ -164.919179, 62.633076 ], [ -164.562508, 63.146378 ], [ -163.753332, 63.219449 ], [ -163.067224, 63.059459 ], [ -162.260555, 63.541936 ], [ -161.534450, 63.455817 ], [ -160.772507, 63.766108 ], [ -160.958335, 64.222799 ], [ -161.518068, 64.402788 ], [ -160.777778, 64.788604 ], [ -161.391926, 64.777235 ], [ -162.453050, 64.559445 ], [ -162.757786, 64.338605 ], [ -163.546394, 64.559160 ], [ -164.960830, 64.446945 ], [ -166.425288, 64.686672 ], [ -166.845004, 65.088896 ], [ -168.110560, 65.669997 ], [ -166.705271, 66.088318 ], [ -164.474710, 66.576660 ], [ -163.652512, 66.576660 ], [ -163.788602, 66.077207 ], [ -161.677774, 66.116120 ], [ -162.489715, 66.735565 ], [ -163.719717, 67.116395 ], [ -164.430991, 67.616338 ], [ -165.390287, 68.042772 ], [ -166.764441, 68.358877 ], [ -166.204707, 68.883031 ], [ -164.430811, 68.915535 ], [ -163.168614, 69.371115 ], [ -162.930566, 69.858062 ], [ -161.908897, 70.333330 ], [ -160.934797, 70.447690 ], [ -159.039176, 70.891642 ], [ -158.119723, 70.824721 ], [ -156.580825, 71.357764 ], [ -155.067790, 71.147776 ], [ -154.344165, 70.696409 ], [ -153.900006, 70.889989 ], [ -152.210006, 70.829992 ], [ -152.270002, 70.600006 ], [ -150.739992, 70.430017 ], [ -149.720003, 70.530010 ], [ -147.613362, 70.214035 ], [ -145.689990, 70.120010 ], [ -144.920011, 69.989992 ], [ -143.589446, 70.152514 ], [ -142.072510, 69.851938 ], [ -140.985988, 69.711998 ] ] ] ] } }
]

var promise = $.getJSON("us-energy.geojson");
promise.then(function(data) {
    var allStates = L.geoJSON(data, {
        pointToLayer: function (feature, latlng) {
            return L.circleMarker(latlng);
        },
            onEachFeature: onEachFeature,
            style: style
    }).addTo(map);
});

function alaskaMarkers (data) {
    var promise = $.getJSON("us-energy.geojson");
    promise.then(function(data){
        var markers = L.geoJSON(data, {
            filter: function (feature, layer) {
               return (feature.properties.State === "AL");
            },
            pointToLayer: function (feature, latlng) {
                return L.circleMarker(latlng);
            },
            onEachFeature: onEachFeature,
            style: style
        }).addTo(map);
    });
}

var myPolygonStyle = {
    "color": "#2f8fce",
    "weight": 5,
    "opacity": 0.1
};

function alaskaPolygon () {
        var polygon = L.geoJSON(states, {
            filter: function (feature) {
                return (feature.properties["adm1_code"] === "USA-3563");
            },
            style: myPolygonStyle
        }).addTo(map);
        console.log("polygon");
}

// function alaskaPolygon () {
//     var promise = $.getJSON("states.geojson");
//     promiseTwo.then(function(data){
//         var polygon = filter: function (feature, layer) {
//             return (feature.properties.id === "49");
//         },
//         pointToLayer: function (feature, coordinates) {
//             return L.polygon(coordinates);
//         }

//     }).addTo(map);
// });
// }

function alaska () {
   // map.clearLayers();
    alaskaPolygon();
    alaskaMarkers();
    map.setView([64.2, -149.4], 4);

}

function getRadius(d) {
    return d > 6400  ? 22 :
            d > 3200  ? 20 :
            d > 1600  ? 18 :
            d > 800  ? 16 :
            d > 400  ? 12 :
            d > 200 ? 10 :
            d > 100  ? 8 :
            d > 50  ? 6 :
                    4;
}

var colors = {
    "Coal": "#333333",
    "Gas": "#0b4572",
    "Solar": "#EFC530",
    "Nuclear": "#A14A7B",
    "Oil": "#673b9b",
    "Hydro": "#2f8fce",
    "Wind": "#136400",
    "Biomass": "#A7B734",
    "Waste": "#dd8a3e",
    "Storage": "#ffada9",
    "Geothermal": "#C7432B",
    "Other": "#7c5641"
}

function style(feature) {
    return {
        fillColor: colors[feature.properties["Fuel type"]],
        weight: 0.3,
        opacity: 0.3,
        color: 'white',
        fillOpacity: 0.65,
		radius: getRadius(feature.properties["Capacity (MW)"])
    };
}

function onEachFeature(feature, layer) {
	// does this feature have a property named popupContent?
	if (feature.properties) {
		layer.bindPopup('<h1><b>'+feature.properties["Plant Name"]+'</h1>Capacity: </b>'+feature.properties["Capacity (MW)"]+'MW <br /><b>Type: </b>'+feature.properties["Fuel type"]+'<br /><b>Year opened: </b>'+feature.properties["Year opened"], {closeButton: false, offset: L.point(0, -20)});
				layer.on('mouseover', function() { layer.openPopup(); });
				layer.on('mouseout', function() { layer.closePopup(); });
	};

}

//add zoomHome plugin

var zoomHome = L.Control.zoomHome();
zoomHome.addTo(map);